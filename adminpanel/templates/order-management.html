`{% extends 'base.html' %}
{% block body %}
<section class="demandRight boxs">
    <div class="content-wrapper">
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-message alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        {% endfor %}
        {% endif %}
    </div>
    <div class="demandInner boxs">
        <div class="AddService">
            <h2 class="main">Order Management
            </h2>
        </div>
        <div class="tableList boxs bgWhite">
            <div class="filterCode">
                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-group formGroup">
                            <span class="labelel2">From</span>
                            <input type="date" class="form-control " placeholder="From">
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group formGroup">
                            <span for="" class="labelel2">To</span>
                            <input type="date" class="form-control " placeholder="To">
                        </div>
                    </div>
                    <div class="col-sm-3" style="padding-top: 20px;">
                        <button class="btns">Search</button>
                    </div>
                </div>
            </div>
            <div class="scrollAll">
                <table id="example" class="table table-striped table-bordered" style="width:100%">
                    <thead>
                    <tr>
                        <th>S.No</th>
                        <th>Order Id</th>
                        <th>Ordered For Date</th>
                        <th>Ordered For Time</th>
                        <th>Admin Percent</th>
                        <th>Username</th>
                        <th>User ID</th>
                        <th>User address</th>
                        <th>Service</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for obj in object_list %}
                    <tr>
                        <th>{{forloop.counter}}</th>
                        <th>{{obj.id}}</th>
                        <th>{{obj.date}}</th>
                        <th>{{obj.time}}</th>
                        <th>{{obj.admin_percent}}</th>
                        <th>{{obj.user.full_name}}</th>
                        <th>{{obj.user.id}}</th>
                        <th>{{obj.address}}</th>
                        <th>{{obj.service.service_name}}</th>
                        <th>
                            <a href="{% url 'adminpanel:order-detail' obj.id %}" class="btns">View Detail </a>
                            {% if obj.status == 'Accepted' %}
                            <button value="{{obj.id}}" class="btns orderModalButton" data-toggle="modal"
                                    data-target="#assign">Assign Providers
                            </button>
                            {% else %}
                            <button value="{{obj.id}}" class="btns orderQuoteButton" data-toggle="modal"
                                    data-target="#quote">Send offer price
                            </button>
                            {% endif %}
                        </th>
                    </tr>
                    {% endfor %}
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</section>

<div class="modal fade" id="assign" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-body">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <div class="form-group">
                    <div id="object_id_placeholder_div">
                        <input hidden="true" id="object_id_placeholder_input" value="">
                    </div>
                    <label for="">Categories</label>
                    <select name="cars" id="categories" required class="form-control formControl"
                            placeholder="Select Service Provider">
                        <option>Select Category</option>
                        {% for obj in categories %}
                        <option value="{{obj.pk}}" id="categoriesId">{{obj.category_name}}</option>
                        {% endfor %}
                    </select>
                    <label for="">Service Providers</label>
                    <select name="cars" id="services" required class="form-control formControl"
                            placeholder="Select Service Provider">
                        <option value="">Select Provider</option>
                        {% for obj in service_provider %}
                        <option value="{{obj.pk}}" id="serviceProviderId">{{obj.email}}</option>
                        {% endfor %}
                    </select>
                    <br>
                    <div class="form-group formGroup">
                        <span for="" class="labelel2">Admin Percent</span>
                        <input type="number" class="form-control " placeholder="Admin Percent" id="admin_percent" name="admin_percent">
                    </div>


                    <ul class="allBtns">
                        <li>
                            <button type="button" id="serviceProviderButton" class="btns">Submit</button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="quote" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-body">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <div class="form-group">
                    <div id="object_id_placeholder_div2">
                        <input hidden="true" id="object_id_placeholder_input2" value="">
                    </div>
                    <label for="">Quote</label>
                    <input type="number" name="quote" id="quoteInput" required class="form-control formControl"
                           placeholder="SAR">
                    <ul class="allBtns">
                        <li>
                            <button type="button" id="quoteButton" class="btns">Send quote</button>
                        </li>
                    </ul>
                </div>
            </div>

        </div>

    </div>
</div>
<script>
$(document).ready(function () {
    $('.orderModalButton').click(function (e) {
        console.log('clicked orderModalButton')
        e.preventDefault();
//        $('.modal').addClass('show');
        var value = $(this).val();
        console.log("value",value)
        $("#object_id_placeholder_div").html(`<input hidden="true" id="object_id_placeholder_input" value="` + value + `">`)
    });
    $('.CloseModal').click(function (e) {
        e.preventDefault();
//        $('.modal').removeClass('show');
    });

    $("#serviceProviderButton").click(function () {
        var object_id = $("#object_id_placeholder_input").val();
        console.log('Id ',object_id)
        var serviceProviderId = $("#services").val();
        var admin_percent = $("#admin_percent").val();
        console.log('Service Provider id',serviceProviderId)
        var protocol = window.location.protocol
        var hostname = window.location.hostname
        var port = window.location.port
        var url = protocol + "//" + hostname + ":" + port + "/adminpanel" + "/assign-service-provider" + "/"
        $.ajax({
            url:url,
            method:'POST',
            data:{
                'csrfmiddlewaretoken': "{{ csrf_token }}",
                'serviceProviderId':serviceProviderId,
                'orderId':object_id,
                'admin_percent':admin_percent
            },
            success: function (data) {
            console.log('inside publicationId success')
            window.location.href = protocol + "//" + hostname + ":" + port + "/adminpanel" + "/order-management/"
      }
        })
    });
});










</script>
<script>
$(document).ready(function () {
    $('.orderQuoteButton').click(function (e) {
        console.log('clicked orderModalButton')
        e.preventDefault();
//        $('.modal').addClass('show');
        var value = $(this).val();
        console.log("value",value)
        $("#object_id_placeholder_div2").html(`<input hidden="true" id="object_id_placeholder_input2" value="` + value + `">`)
    });
    $('.CloseModal').click(function (e) {
        e.preventDefault();
//        $('.modal').removeClass('show');
    });

    $("#quoteButton").click(function () {
        var object_id = $("#object_id_placeholder_input2").val();
        console.log('Id ',object_id)
        var quote = $("#quoteInput").val();
        console.log('Service Provider id',quote)
        var protocol = window.location.protocol
        var hostname = window.location.hostname
        var port = window.location.port
        var url = protocol + "//" + hostname + ":" + port + "/adminpanel" + "/send-quote" + "/"
        $.ajax({
            url:url,
            method:'POST',
            data:{
                'csrfmiddlewaretoken': "{{ csrf_token }}",
                'quote':quote,
                'orderId':object_id
            },
            success: function (data) {
            console.log('inside publicationId success')
            window.location.href = protocol + "//" + hostname + ":" + port + "/adminpanel" + "/order-management/"
      }
        })
    });
});






</script>
<script>
    $("#categories").change(function () {
    var protocol = window.location.protocol
    var hostname = window.location.hostname
    var port = window.location.port
    var url =  protocol + "//" + hostname + ":" + port +"/adminpanel"+ "/service-provider-category" + "/";
    console.log(url)
    var categoryId = $(this).val();
    console.log('category Id---->> ',categoryId)

    $.ajax({
      url: url,

      data: {
        'categoryId': categoryId,
      },
      success: function (t) {
      console.log('inside categoryId success',t)
      $('#services').html(t);
      }
    });
  });





</script>
{% endblock body %}`